font:
  - {file: {type: gfonts, family: "Dancing Script"},   id: descriptionFont,              size: 14, glyphs: "!\"'%-./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz"}
  - {file: {type: gfonts, family: "Roboto"},           id: bottomLabelFont,              size: 10, glyphs: "!\"'%-.*,/0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz"}
  - {file: {type: gfonts, family: "Permanent Marker"}, id: mainTitleFont,                size: 24}
  - {file: {type: gfonts, family: "Permanent Marker"}, id: playingForFont,               size: 14}
  - {file: {type: gfonts, family: "Permanent Marker"}, id: remainingTimeFont,            size: 21}
  - {file: {type: gfonts, family: "Roboto"},           id: remainingTimeDescriptionFont, size: 9}
  - {file: {type: gfonts, family: "Roboto", weight: 700},  id: startButtonFont,          size: 16}
  - {file: {type: gfonts, family: "Roboto", weight: 500},  id: weeklyRemainingFont,      size: 21}


image:
  - {file: "screenTime/assets/mario.png",          id: mario_image,          type: RGB565, use_transparency: true, resize: 58x41 }
  - {file: "screenTime/assets/tv.png",             id: tv_image,             type: RGB565, use_transparency: true, resize: 52x54 }
  - {file: "screenTime/assets/star.png",           id: star_image,           type: RGB565, use_transparency: true, resize: 20x20 }
  - {file: "screenTime/assets/greenButton_100.png",id: greenButton_image,    type: RGB565, use_transparency: true, resize: 70x70 }
  - {file: "screenTime/assets/redButton_100.png",  id: redButton_image,      type: RGB565, use_transparency: true, resize: 70x70 }
  - {file: "screenTime/assets/lock.png",           id: lock_image,           type: RGB565, use_transparency: true, resize: 40x50 }
  - {file: "screenTime/assets/cog.png",            id: cog_image,            type: RGB565, use_transparency: true, resize: 18x18 }
  - {file: "screenTime/assets/Mario/mario_frame_00.png", id: mario_frame_00, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_01.png", id: mario_frame_01, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_02.png", id: mario_frame_02, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_03.png", id: mario_frame_03, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_04.png", id: mario_frame_04, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_05.png", id: mario_frame_05, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_06.png", id: mario_frame_06, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_07.png", id: mario_frame_07, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_08.png", id: mario_frame_08, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_09.png", id: mario_frame_09, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_10.png", id: mario_frame_10, type: RGB565, use_transparency: true, resize: 43x43 }
  - {file: "screenTime/assets/Mario/mario_frame_11.png", id: mario_frame_11, type: RGB565, use_transparency: true, resize: 43x43 }

script:
  - id: start_button_checked
    then:
      - lvgl.widget.hide: weeklyReport_container
      - lvgl.widget.show: playingNow_container
      - lvgl.image.update: 
          id: start_button_image_id
          src: redButton_image
      - lvgl.label.update:
          id: start_button_label
          text: STOP
      - lvgl.label.update:
          id: bottomLabel
          text: "Press *STOP* button when you are done watching TV."
  - id: start_button_unchecked
    then:
      - lvgl.widget.hide: playingNow_container
      - lvgl.widget.show: weeklyReport_container
      - lvgl.image.update: 
          id: start_button_image_id
          src: greenButton_image
      - lvgl.label.update:
          id: start_button_label
          text: START
      - lvgl.label.update:
          id: bottomLabel
          text: "Press *START* button when you want to watch TV or play games"
  - id: check_password
    then:
      - if:
          condition:
            lambda: |- 
              return strcmp(lv_textarea_get_text(id(password_input)), id(pin_code).c_str()) == 0;
          then:
            - lvgl.page.show: settings_page
            - lvgl.textarea.update:
                id: password_input
                text: ""
          else:
            - lvgl.widget.show: wrong_pin_msg
            - lvgl.textarea.update:
                id: password_input
                text: ""

lvgl:
  displays:
    - my_display
  touchscreens:
    - my_touch
  buffer_size: 25%
  bg_color: 0x25387d
  bg_grad_color: 0x1b7bcc
  bg_grad_dir: VER
  pad_all: 0
  style_definitions:
    - id: blue_container
      radius: 10
      border_width: 1
      border_color: 0x002f8c
      bg_color: 0x058ceb
      bg_grad_color: 0x2d82be
      bg_grad_dir: VER
      pad_all: 0
      scrollbar_mode: 'OFF'
  msgboxes:
    - id: wrong_pin_msg
      close_button: true
      title: Wrong Pin
      x: 10
      y: 10
      width: 300
      height: 220
      radius: 4
      bg_opa: 80%
      bg_color: 0xda0021
      bg_grad_color: 0xff6500
      bg_grad_dir: VER
      body:
        text: Please try again or call an adult.
        bg_color: 0xda0021
        bg_grad_color: 0xff6500
        bg_grad_dir: VER

    - id: settings_applied_msg
      close_button: false
      title: Settings Applied
      x: 10
      y: 10
      width: 300
      height: 220
      radius: 4
      bg_opa: 80%
      bg_color: 0x009400
      bg_grad_color: 0x00FF00
      bg_grad_dir: VER
      body:
        y: 150
        text: Settings have been successfully applied.
        text_font: montserrat_12
        text_align: center
        bg_color: 0x009400

    - id: factory_reset_msg
      close_button: true
      title: Factory Reset
      x: 10
      y: 10
      width: 300
      height: 220
      radius: 4
      bg_opa: 80%
      bg_color: 0xda0021
      bg_grad_color: 0xff6500
      bg_grad_dir: VER
      body:
        text: Please confirm you want to perform factory reset. All the data will be lost.
        bg_color: 0xda0021
        bg_grad_color: 0xff6500
        bg_grad_dir: VER
      buttons:
        - text: Reset
          on_click:
            then:
              - lvgl.widget.hide: factory_reset_msg
              - button.press: factory_reset_button

    - id: firmware_update_msg
      close_button: true
      title: "Firmware Update Available"
      x: 10
      y: 10
      width: 300
      height: 220
      radius: 4
      bg_opa: 80%
      bg_color: 0x0000FF
      bg_grad_color: 0x00FFFF
      bg_grad_dir: VER
      body:
        text: "A new firmware update is available. Would you like to download and install it?"
        bg_color: 0x0000FF
        bg_grad_color: 0x00FFFF
        bg_grad_dir: VER
      buttons:
        - text: "Download"
          on_click:
            then:
              - script.execute: download_firmware
              - lvgl.widget.hide: factory_reset_msg

  pages:
    - !include page_boot.yaml           
    - !include page_main.yaml
    - !include page_password.yaml
    - !include page_settings.yaml           
        
    - id: fake_page  # needs a fake buttonmatrix, otherwise message box will not work
      skip: true
      widgets:
        - buttonmatrix:
            rows:

          